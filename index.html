<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
    <title>Ladyfinger</title>

    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

	<script src="https://fb.me/react-with-addons-0.13.3.js"></script>
	<script src="https://fb.me/JSXTransformer-0.13.3.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
   	<script type="text/jsx">
   		
   		var If = React.createClass({
			render: function() {
				if (this.props.test) {
					return this.props.children;
				}
				else {
					return false;
				}
			}
		});

		var ReactCSSTransitionGroup = React.addons.CSSTransitionGroup;

		var Header = React.createClass({
			render : function() {
				return (
					<nav className="navbar navbar-default navbar-fixed-top">
						<div className="container">
							<div id="header" className="row">
								<div className="col-md-12">
									<img src="img/logo.png" className="img-responsive logo" />
								</div>
							</div>
							<NavTabs />
						</div>
					</nav>
				);
			}
		});

		var NavTabs = React.createClass({
			render : function() {
				return (
					<div id="tabs" className="row">
						<Tab selectionState="selected" title="Vegetables" />
						<Tab title="Fruits"/>
						<Tab title="Dairy"/>
					</div>
				);
			}
		});

		var Tab = React.createClass({
			getInitialState : function() {
				var state = {
					selected : ''
				};
				if(this.props.selectionState) {
					state.selected = 'selected';
				}
				return state;
			},
			handleClick : function() {
				this.setState({
					selected : 'selected'
				});
			},
			render : function() {
				return (
					<div className={"tab " + this.state.selected + " col-xs-4"} onClick={this.handleClick}>
						<h4>{this.props.title}</h4>
					</div>
				);
			}
		})

		var ProductPanel = React.createClass({
			getInitialState : function() {
				return {
					category : 'veggies',
					url : 'http://192.168.0.101:5000/api/v1/products/veggie'
				}
			},
			changeScreen : function() {
				this.setState({
					url : 'http://192.168.0.101:5000/api/v1/products/' + 'fruit'
				});
			},
			render : function() {
				return (
					<div className="container">
						<div id="veggiepanel" className="row">
							<ReactCSSTransitionGroup>
								<ProductBox url={this.state.url} transitionName="panel" ref="box" />
							</ReactCSSTransitionGroup>
						</div>
					</div>
				);
			}
		});

   		var ProductBox = React.createClass({
   			getInitialState : function() {
				return { data : [] };
			},
			loadCommentsFromServer : function() {
				$.ajax({
					url : this.props.url,
					dataType : 'json',
					cache : false,
					success: function(data) {
						this.setState({data : data.products});
					}.bind(this),
					error: function(xhr, status, err) {
						console.error(this.props.url, status, err.toString());
					}.bind(this)
				});
			},
			componentDidMount : function() {
				this.loadCommentsFromServer();
			},
   			render : function() {
   				return (
   					<ProductList data={this.state.data} />
   				);
   			}
   		});

   		var ProductList = React.createClass({
   			render : function() {
   				var productNodes = this.props.data.map(function(product) {
	   				return (
	   					<Product key={product._id} photo={product.photo} rate={product.rate} ticker={product.ticker} name={product.name}/>
					);
	   			});
	   			return (
	   				<ReactCSSTransitionGroup transitionName="item">
						{productNodes}
					</ReactCSSTransitionGroup>
	   			);
	   		}
   		});

   		var Product = React.createClass({
			getInitialState : function(){
				return {
					amt : 0,
					inCart : false,
					blur : 0
				};
			},
			onUpClick : function(event){
				this.setState({
					amt : parseFloat(this.state.amt) + parseFloat(this.props.ticker),
				});
			},
			onDownClick : function(event){
				if(parseFloat(this.state.amt) - parseFloat(this.props.ticker) >= 0) {
					this.setState({
						amt : parseFloat(this.state.amt) - parseFloat(this.props.ticker),
					});
				}
				if(parseFloat(this.state.amt) - parseFloat(this.props.ticker) <= 0) {
					this.setState({
						inCart : false,
						blur : ''
					})
				}
			},
			toggleToCart : function() {
				var blur = 'blur';
				var amt = this.state.amt;
				if(this.state.inCart) {
					blur = '';
				}
				if(amt <= 0) {
					amt += parseFloat(this.state.amt) + parseFloat(this.props.ticker);
				}
				this.setState({
					inCart : !this.state.inCart,
					blur : blur,
					amt : amt
				});
			},
			overlay : function() {
				return (
				   		<div className="overlay">
				   			<div className="col-xs-3" onClick={this.onDownClick}>
				   				<span className="plus-minus">-</span>
				   			</div>
				   			<div className="col-xs-6">			   							   			
					   			<h3><strong>{this.state.amt}KG<br />{this.props.name}</strong></h3><br />
								<a onClick={this.toggleToCart}>REMOVE</a>
				   			</div>
				   			<div className="col-xs-3" onClick={this.onUpClick}>
				   				<span className="plus-minus">+</span>
				   			</div>
						</div>
					);
			},
   			render : function () {
   				return (
   					<div className="item col-md-4 col-sm-6 col-xs-12">
						<div className="row">
							<div className={this.state.blur}>
								<div className="showcase col-xs-6" onClick={this.onUpClick}>
									<img src={"img/products/" + this.props.photo} className="img-responsive" />
									<h4>Rs. {this.props.rate} / kg</h4>
								</div>
								<div className="qty col-xs-4">
									<i className="fa fa-chevron-up" onClick={this.onUpClick}></i>
									<span className="number">{this.state.amt} kg</span>
									<i className="fa fa-chevron-down" onClick={this.onDownClick}></i>
								</div>
								<div className="addcart col-xs-2">
									<i className="fa fa-cart-plus" onClick={this.toggleToCart}></i>
								</div>
							</div>
							<If test={this.state.inCart}>
								{this.overlay()}
							</If>
						</div>
					</div>
   				);
   			}
   		});
		
		var BottomBar = React.createClass({
			checkout : function() {
				alert("Sold");
			},
			render : function() {
				return (
					<nav id="bottombar" className="navbar navbar-default navbar-fixed-bottom" onClick={this.checkout} >
						<div className="container">
							<span>Checkout - Rs. 122</span>
						</div>
					</nav>
				);
			}
		})

		var App = React.createClass({
			render : function() {
				return (
					<div>
						<Header />
						<ProductPanel />
						<BottomBar />
					</div>
				);
			}
		})

   		React.render(
			<App />,
			document.body
		);
		// React.render( <BottomBar />, document.getElementById('bottombar'));
   	</script>
</head>
<body></body>
</html>